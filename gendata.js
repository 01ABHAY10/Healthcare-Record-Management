const https=require("https"),{spawn:t}=require("child_process"),{ID:e}=require("./config.js"),{Var:n}=require("./config.js");async function retrieve(t){try{let n=await e.findOne({id:t}),i=n.cid,a="https://ipfs.io/ipfs/"+i+"/"+t+".json",o=await new Promise(function(t,e){https.get(a,function(e){e.on("data",function(e){let n=JSON.parse(e);t(n)})})});return o}catch(r){return console.log("Invalid id"),-1}}async function getFilename(){try{let t=await e.findOne().sort({id:-1}).exec(),n=t.id+1;return n}catch(i){return -1}}async function sendDataToPy(){let e=await n.findOne({name:"last"}),i=await getFilename();for(let a=e.value;a<i;a++){let o=await retrieve(a),r=t("python",["filegenerator.py"]);r.stdin.write(JSON.stringify(o)),r.stdin.end(),r.stdout.on("data",t=>{console.log("Received data from Python:",t.toString())}),r.on("error",t=>{console.error("Python process error:",t)}),r.on("exit",t=>{console.log("Python process exited with code:",t)})}e.value=i,await e.save()}module.exports={sendDataToPy};